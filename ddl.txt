-- database : bidsdata

-- 입찰데이터
CREATE TABLE `bids` (
  `match_no` int(11) DEFAULT NULL, -- 경기 번호
  `seat_no` varchar(10) NOT NULL, -- 좌석 번호
  `bid_telno` varchar(11) NOT NULL, -- 입찰자 전화번호
  `bid_amount` int(11) NOT NULL, -- 입찰 금액
  `bid_at` timestamp NOT NULL, -- 입찰 시간
  `bid_won` varchar(1) DEFAULT 'N', -- 낙찰 여부 ('Y', 'N')
  `bid_paid` varchar(1) DEFAULT 'N', -- 결제 여부 ('Y', 'N')
  `pay_method` varchar(45) DEFAULT NULL, -- 결제 방법
  `bid_userid` varchar(15) DEFAULT NULL, -- 입찰자 아이디(현재 전화번호호)
  `row_no` int(11) DEFAULT NULL, -- 좌석 행 번호
  `col_no` int(11) DEFAULT NULL, -- 좌석 열 번호
  `pay_oid` varchar(45) DEFAULT NULL -- 결제 고유 ID(inicis 결제 요청시 생성된 번호 기록)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 입찰 사용자
CREATE TABLE `biduser` (
  `userid` varchar(30) DEFAULT NULL, -- 사용자 ID (현재는 사용하지 않음)
  `password` varchar(100) NOT NULL, -- 비밀번호
  `username` varchar(30) NOT NULL, -- 사용자 이름
  `email` varchar(45) DEFAULT NULL, -- 이메일
  `telno` varchar(20) NOT NULL, -- 전화번호
  `postcode` varchar(10) DEFAULT NULL, -- 우편번호
  `addr1` varchar(45) DEFAULT NULL, -- 기본 주소
  `addr2` varchar(45) DEFAULT NULL, -- 상세 주소
  `created_at` datetime DEFAULT NULL, -- 생성 날짜
  `usertype` varchar(1) DEFAULT 'U', -- 사용자 유형 ('U': 일반 사용자, 현재는 사용하지 않음, role을 이용함)
  `id` bigint(20) NOT NULL AUTO_INCREMENT, -- 고유 ID
  `role` varchar(10) DEFAULT NULL, -- 사용자 역할
  PRIMARY KEY (`id`),
  UNIQUE KEY `telno_UNIQUE` (`telno`) -- 전화번호 유니크 키
) ENGINE=InnoDB AUTO_INCREMENT=27 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 경기 정보 테이블
CREATE TABLE `matches` (
  `match_no` int(11) NOT NULL, -- 경기 번호
  `venue_cd` varchar(3) NOT NULL, -- 경기장 코드
  `match_name` varchar(100) NOT NULL, -- 경기 이름
  `round` varchar(100) NOT NULL, -- 라운드 이름
  `approved` varchar(1) NOT NULL DEFAULT 'N', -- 승인 여부 ('Y', 'N')
  `bid_open_status` varchar(1) DEFAULT 'I', -- 입찰 오픈 상태 ('I': 준비 중. 'F' 낙찰완료, 나머지 상태는 입찰 시작시간 종료시간을 기준으로 결정됨 )
  `alimtalk_sent` varchar(1) DEFAULT 'N', -- 알림톡 발송 여부 ('Y', 'N')
  `bid_open_datetime` datetime DEFAULT NULL, -- 입찰 시작 시간
  `bid_close_datetime` datetime DEFAULT NULL, -- 입찰 종료 시간
  `alimtalk_sent_at` timestamp NULL DEFAULT NULL, -- 알림톡 발송 시간
  `start_date` date DEFAULT NULL, -- 경기 시작 날짜
  `start_time` time DEFAULT NULL, -- 경기 시작 시간
  `end_time` time DEFAULT NULL, -- 경기 종료 시간
  `approved_by` varchar(11) DEFAULT NULL, -- 승인자(전화번호)
  `created_by` varchar(11) NOT NULL DEFAULT 'null', -- 생성자(전화번호)
  `is_bid_available` varchar(1) DEFAULT 'N', -- 입찰 가능 여부 ('Y', 'N')
  `filename_attached` varchar(200) DEFAULT NULL, -- 첨부 파일 이름(사용자 화일명에 random number가 추가되어 전송됨 randomnumber_화일명 형식으로)
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(), -- 수정 시간
  `updated_by` varchar(11) DEFAULT NULL, -- 수정자 전화번호
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(), -- 생성 시간
  `pay_due_datetime` datetime DEFAULT NULL, -- 결제 기한
  `reserved` varchar(1) DEFAULT 'N', -- 일괄 입찰 여부 ('Y', 'N')
  `reserved_amount` int(11) DEFAULT 0, -- 일괄 입찰 금액
  `reserved_approval` varchar(1) DEFAULT 'N', -- 일괄 입찰 승인 여부 ('Y', 'N')
  `reserved_at` timestamp NULL DEFAULT current_timestamp(), -- 일괄 입찰 시간
  `reserved_approval_at` timestamp NULL DEFAULT NULL, -- 일괄 입찰 승인 시간
  PRIMARY KEY (`match_no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- inicis 결제 요청 및 승인 기록 테이블 (mobile과 PC로 결제 여부에 따라 null이 되는 경우가 많음)
CREATE TABLE `payments` (
  `payDevice` varchar(20) DEFAULT NULL, -- 결제 장치(mobile, PC)
  `P_OID` varchar(50) DEFAULT NULL, -- 주문 번호
  `P_TRAN_TYPE` varchar(1) DEFAULT NULL, -- 거래 유형 - 'R':결제 요청정보 'A'결제 승인정보
  `P_AUTH_DT` varchar(45) DEFAULT NULL, -- 인증 날짜
  `P_AUTH_NO` varchar(20) DEFAULT NULL, -- 인증 번호
  `P_UNAME` varchar(50) DEFAULT NULL, -- 사용자 이름
  `P_EMAIL` varchar(45) DEFAULT NULL, -- 사용자 이메일
  `P_MOBILE` varchar(45) DEFAULT NULL, -- 사용자 휴대폰 번호
  `P_GOODS` varchar(45) DEFAULT NULL, -- 상품명
  `P_AMT` varchar(45) DEFAULT NULL, -- 결제 금액
  `P_TID` varchar(50) DEFAULT NULL, -- 거래 ID
  `P_TIMESTAMP` varchar(45) DEFAULT NULL, -- 거래 타임스탬프
  `P_HPP_METHOD` varchar(45) DEFAULT NULL, -- 결제 방법
  `P_STATUS` varchar(5) DEFAULT NULL, -- 결제 상태
  `P_CARD_NUM` varchar(50) DEFAULT NULL, -- 카드 번호
  `P_CARD_APPLPRICE` varchar(45) DEFAULT NULL, -- 카드 승인 금액
  `P_CARD_PRTC_CODE` varchar(5) DEFAULT NULL, -- 카드 PRTC 코드
  `P_CARD_INTEREST` varchar(45) DEFAULT NULL, -- 카드 이자
  `P_CARD_CHECKFLAG` varchar(5) DEFAULT NULL, -- 카드 체크 플래그
  `P_CARD_MEMBER_NUM` varchar(50) DEFAULT NULL, -- 카드 회원 번호
  `P_CARD_PURCHASE_NAME` varchar(50) DEFAULT NULL, -- 카드 발행사 이름
  `CARD_CorpFlag` varchar(5) DEFAULT NULL, -- 카드 회사 플래그
  `P_NOTEURL` varchar(255) DEFAULT NULL, -- 노트 URL
  `P_CARD_ISSUER_NAME` varchar(50) DEFAULT NULL, -- 카드 발급사 이름
  `P_CARD_ISSUER_CODE` varchar(5) DEFAULT NULL, -- 카드 발급사 코드
  `P_CARD_PURCHASE_CODE` varchar(5) DEFAULT NULL, -- 카드 발행사 코드
  `EventCode` varchar(50) DEFAULT NULL, -- 이벤트 코드
  `P_MERCHANT_RESERVED` varchar(255) DEFAULT NULL, -- 상점 예약 필드
  `P_MNAME` varchar(50) DEFAULT NULL, -- 상점 이름
  `P_RMESG2` varchar(10) DEFAULT NULL, -- 메시지 2
  `P_RMESG1` varchar(255) DEFAULT NULL, -- 메시지 1
  `P_NOTI` varchar(255) DEFAULT NULL, -- 알림 내용
  `P_FN_NM` varchar(50) DEFAULT NULL, -- 금융사 이름
  `P_MID` varchar(20) DEFAULT NULL, -- 상점 ID
  `P_TYPE` varchar(10) DEFAULT NULL, -- 거래 유형
  `P_FN_CD1` varchar(5) DEFAULT NULL, -- 금융 코드
  `P_INI_PAYMENT` varchar(45) DEFAULT NULL, -- 초기 결제
  `P_NOTI_URL` varchar(45) DEFAULT NULL, -- 알림 URL
  `resultCode` varchar(10) DEFAULT NULL, -- 결과 코드
  `resultMsg` varchar(255) DEFAULT NULL, -- 결과 메시지
  `MOID` varchar(50) DEFAULT NULL, -- MOID
  `applDate` varchar(45) DEFAULT NULL, -- 승인 날짜
  `applTime` varchar(45) DEFAULT NULL, -- 승인 시간
  `CARD_Quota` varchar(10) DEFAULT NULL, -- 카드 할부 기간
  `CARD_ClEvent` varchar(255) DEFAULT NULL, -- 카드 클리어 이벤트
  `parentEmail` varchar(100) DEFAULT NULL, -- 부모 이메일
  `OrgPrice` varchar(50) DEFAULT NULL, -- 원래 가격
  `p_Sub` varchar(255) DEFAULT NULL, -- 추가 필드
  `CARD_UsePoint` varchar(10) DEFAULT NULL, -- 카드 포인트 사용 여부
  `CARD_Num` varchar(20) DEFAULT NULL, -- 카드 번호
  `authSignature` varchar(255) DEFAULT NULL, -- 인증 서명
  `payMethod` varchar(20) DEFAULT NULL, -- 결제 방법
  `CARD_MemberNum` varchar(20) DEFAULT NULL, -- 카드 회원 번호
  `CARD_Point` varchar(10) DEFAULT NULL, -- 카드 포인트
  `currency` varchar(10) DEFAULT NULL, -- 통화 단위
  `CARD_PurchaseCode` varchar(10) DEFAULT NULL, -- 카드 구매 코드
  `CARD_PrtcCode` varchar(5) DEFAULT NULL, -- 카드 PRTC 코드
  `goodsName` varchar(255) DEFAULT NULL, -- 상품명
  `CARD_CheckFlag` varchar(5) DEFAULT NULL, -- 카드 체크 플래그
  `FlgNotiSendChk` varchar(10) DEFAULT NULL, -- 알림 발송 체크
  `CARD_Code` varchar(10) DEFAULT NULL, -- 카드 코드
  `CARD_BankCode` varchar(10) DEFAULT NULL, -- 카드 은행 코드
  `CARD_TerminalNum` varchar(50) DEFAULT NULL, -- 카드 단말기 번호
  `p_SubCnt` varchar(10) DEFAULT NULL, -- 추가 필드 수
  `applNum` varchar(20) DEFAULT NULL, -- 승인 번호
  `CARD_Interest` varchar(5) DEFAULT NULL, -- 카드 이자 여부
  `CARD_SrcCode` varchar(5) DEFAULT NULL, -- 카드 소스 코드
  `CARD_ApplPrice` varchar(45) DEFAULT NULL, -- 카드 승인 금액
  `CARD_GWCode` varchar(5) DEFAULT NULL, -- 카드 GW 코드
  `custEmail` varchar(100) DEFAULT NULL, -- 고객 이메일
  `CARD_Expire` varchar(10) DEFAULT NULL, -- 카드 만료 날짜
  `CARD_PurchaseName` varchar(100) DEFAULT NULL, -- 카드 구매사 이름
  `CARD_PRTC_CODE` varchar(5) DEFAULT NULL, -- 카드 PRTC 코드
  `P_USE_CHKFAKE` varchar(45) DEFAULT NULL -- 가짜 체크 플래그
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 리프레시 토큰 기록
CREATE TABLE `refresh` (
  `username` varchar(45) DEFAULT NULL, -- 사용자 이름
  `refresh` varchar(255) DEFAULT NULL, -- 리프레시 토큰
  `expiration` datetime DEFAULT NULL, -- 만료 시간
  `id` int(11) NOT NULL AUTO_INCREMENT, -- 고유 ID
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=963 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 경기별 좌석번호별 좌석 초기 가격
CREATE TABLE `seatprice` (
  `row_no` varchar(3) DEFAULT NULL, -- 좌석 행 번호
  `col_no` varchar(3) DEFAULT NULL, -- 좌석 열 번호
  `seat_no` varchar(3) NOT NULL, -- 좌석 번호
  `seat_price` int(11) NOT NULL, -- 좌석 가격
  `match_no` varchar(3) NOT NULL, -- 경기 번호
  PRIMARY KEY (`seat_no`,`match_no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- 경기장 코드 테이블
CREATE TABLE `venue_code` (
  `venue_cd` char(3) NOT NULL, -- 경기장 코드
  `venue_name` varchar(45) DEFAULT NULL, -- 경기장 이름
  `venue_place_info` varchar(45) DEFAULT NULL, -- 경기장 장소 정보
  `venue_general_info` varchar(45) DEFAULT NULL, -- 경기장 일반 정보
  `venue_img_file` varchar(100) DEFAULT NULL, -- 경기장 이미지 파일 이름름
  PRIMARY KEY (`venue_cd`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
